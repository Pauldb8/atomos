<script>
	$("tray").append("<button name=\"notification\" style='color: #17a2b8; font-size:16px !important;' class='material-icons p-2'>message</button>");
	let notificationsMenu;
	let mute = false;
	notificationsMenu = new BrowserWindow({
		width: Math.ceil(400 * systemRegistry.uiScaling),
		height: Math.ceil(260 * systemRegistry.uiScaling),
		type: "notification",
		frame: false,
		closable: false,
		maximizable: false,
		showOnLoad: false,
		minimizable: false,
		skipTaskbar: true,
		movable: false,
		resizable: false,
		x: x + width - Math.ceil(400 * systemRegistry.uiScaling),
		y: y + height - Math.ceil(260 * systemRegistry.uiScaling) - Math.ceil(32 * systemRegistry.uiScaling),
		show: false,
		alwaysOnTop: true,
		transparent: true
	});
	notificationsMenu.loadURL("file://" + app.getPath("os") + "/sys/notification/index.html");
	$("[name=notification]").on("click", function () {
		if (notificationsMenu.isVisible()) {
			notificationsMenu.hide();
		} else {
			notificationsMenu.show();
			notificationsMenu.setAlwaysOnTop(true);
		}
	});
	app.window.on("close", () => {
		notificationsMenu.destroy();
	});
	notificationsMenu.on('blur', function () {
		app.webContents.send("deactivate-tray", {
			win: 'notification'
		});
		notificationsMenu.hide()
	});
	notificationsMenu.on('focus', function () {
		app.webContents.send("activate-tray", {
			win: 'notification'
		});
		notificationsMenu.show()
	});
	$("[name=notification]").on("contextmenu", function (e) {
		e.preventDefault();
		e.stopImmediatePropagation();
		notificationsMenu.webContents.send("isMuted");

	});
	ipcRenderer.on("isMuted", function (e, mute) {
		Menu.buildFromTemplate([{
			label: "Mute all notifications",
			type: "checkbox",
			checked: mute,
			click() {
				notificationsMenu.webContents.send("mute", !mute);
			}
		}, {
			label: "Configure notifications...",
			click() {
				app.launch("control", {
					section: "Notifications"
				})
			}
		}, {type: 'separator'}, {
			label: "Taskbar Settings",
			click() {
				app.launch("control", {
					section: "Taskbar"
				})
			}
		}]).popup();
	})
</script>
