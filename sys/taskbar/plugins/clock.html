<script>
	$("tray").append(
		"<button name=\"clock\" style='color: #343a40' class='px-2' title='Date loading...'></button>"
	);
	let clockMenu = new BrowserWindow({
		width: Math.ceil(400 * systemRegistry.uiScaling),
		height: Math.ceil(260 * systemRegistry.uiScaling),
		type: "notification",
		frame: false,
		closable: false,
		maximizable: false,
		showOnLoad: false,
		minimizable: false,
		skipTaskbar: true,
		movable: false,
		resizable: false,
		transparent: true,
		x: x + width - Math.ceil(400 * systemRegistry.uiScaling),
		y: y + height - Math.ceil(260 * systemRegistry.uiScaling) - Math.ceil(32 * systemRegistry.uiScaling),
		show: false,
		alwaysOnTop: true,
	});
	window.onbeforeunload = () => {
		clockMenu.close();
	}
	clockMenu.loadURL("file://" + app.getPath("os") + "/sys/clockMenu/index.html");
	$("[name=clock]").on("click", function() {
		if (clockMenu.isVisible()) {
			clockMenu.hide();
			app.webContents.send("deactivate-tray", {
				win: 'clock'
			})
		} else {
			clockMenu.show();
			clockMenu.setAlwaysOnTop(true);
			app.webContents.send("activate-tray", {
				win: 'clock'
			})
		}
	});
	clockMenu.on('blur', function() {
		app.webContents.send("deactivate-tray", {
			win: 'clock'
		});
		clockMenu.hide()
	});
	$("[name=clock]").on("contextmenu", function(e) {
		e.preventDefault();
		e.stopImmediatePropagation();
		Menu.buildFromTemplate([{
			label: "Time/Date Settings",
			click() {
				app.launch("control", {
					section: "Date and Time"
				})
			}
		}, {
			type: 'separator'
		}, {
			label: "Taskbar Settings",
			click() {
				app.launch("control", {
					section: "Taskbar"
				})
			}
		}]).popup();
	});
	tick();
	setInterval(tick, 10000);

	function tick() {
		$("[name=clock]").text(new Date().toLocaleTimeString({}, {
			hour: '2-digit',
			minute: '2-digit'
		}));
	}
</script>