<link href="/atomos/lib/atomos.css" rel="stylesheet">
<div class="dropdown-menu">
  <button class="dropdown-item">Button</button>
</div>
<style>
  .dropdown-menu {
    box-shadow: none;
    border-radius: 0;
    margin: 0;
    display: inline-block;
    top: 0;
    max-height: none;
  }
</style>
<script>
  window.$ = window.jQuery = require("jquery");
  const {
    remote,
    ipcRenderer
  } = require("electron");
  const {
    BrowserWindow
  } = remote;
  const app = remote.getCurrentWindow();
  var options;
  ipcRenderer.on("spawn-menu", function(event, data) {
    options = data;
    $(".dropdown-menu *").remove();
    data.items.forEach(function(item) {
      if (!item.hidden)
        if (item.type == "separator") {
          $(".dropdown-menu").append("<div class='dropdown-divider'></div>")
        } else if(item.type == "checkbox") {
          $(".dropdown-menu").append('<button ' + (item.disabled ? "disabled" : "") + ' action="' + (item.action === undefined ? item.label.toLowerCase() : item.action) + '" class="dropdown-item custom-control custom-checkbox"><input type="checkbox" ' + (item.checked ? "checked": "") + ' class="custom-control-input"><span class="custom-control-indicator"></span><span class="custom-control-description">' + item.label + '</span></button>')
        } else if(item.type == "radio") {
          $(".dropdown-menu").append('<button ' + (item.disabled ? "disabled" : "") + ' action="' + (item.action === undefined ? item.label.toLowerCase() : item.action) + '" class="dropdown-item custom-control custom-radio"><input type="radio" ' + (item.checked ? "checked": "") + ' class="custom-control-input"><span class="custom-control-indicator"></span><span class="custom-control-description">' + item.label + '</span></button>')
        } else if(item.type == "header") {
          $(".dropdown-menu").append('<div class="dropdown-header">' + item.label + '</div>')
        } else {
          $(".dropdown-menu").append("<button " + (item.disabled ? "disabled" : "") + " action='" + (item.action === undefined ? item.label.toLowerCase() : item.action) + "' class='dropdown-item'>" + item.label + "</button>");
        }
    })
    $(".dropdown-item").off().click(function() {
      remote.BrowserWindow.fromId(options.win).webContents.send("return-menu", $(this).attr("action"), options.params || {});
      closeMenu();
    })
    app.setPosition(Math.ceil(data.x), Math.ceil(data.y));
    app.setSize(Math.ceil($(".dropdown-menu").outerWidth()), Math.ceil($(".dropdown-menu").outerHeight()));
    if (options.show !== false) app.show();
  })
  app.on("blur", function() {
    closeMenu();
  })
  ipcRenderer.on("close-menu", closeMenu);

  function closeMenu() {
    app.hide();
    $(".dropdown-menu *").remove();
  }
</script>
