<main class="p-2">
	<p class="lead">Notifications
		<button class="btn btn-sm btn-info material-icons float-right p-1 m-0" onclick="$('#notifications').html('')">
			done_all
		</button>
	</p>
	<section id="notifications"></section>
</main>
<style>
	main {
		border: 1px solid #17a2b8;
		border-bottom-width: 3px;
	}

	#notifications {
		max-height: 350px;
		overflow: auto;
		border: 1px solid lightgray;
		border-radius: 0.25rem;
		padding: 0.5rem;
	}

	#notifications:empty::before {
		content: "No notifications";
		color: grey;
	}

	#notificationsOpened .btn-info {
		display: none
	}

	#notificationsOpened .media {
		display: none
	}

	#notificationsOpened .media:last-child {
		display: flex;
		border: 0 !important;
	}

	#notifications .media .btn-info {
		display: none;
		position: absolute;
		right: 0;
		top: 0;
	}

	#notifications .media h6 {
		position: relative;
	}

	#notifications .media:hover .btn-info {
		display: inline-block;
	}

	#notifications .media:first-child {
		border: none !important
	}
</style>
<script>
	const {
		remote,
		ipcRenderer,
		screen
	} = require('electron');
	const {
		app,
		BrowserWindow
	} = remote;
	const win = remote.getCurrentWindow();
	const {
		width,
		height,
		x,
		y
	} = screen.getPrimaryDisplay().bounds;
	window.$ = window.jQuery = require('jquery');

	let taskbar = BrowserWindow.fromId(remote.getGlobal("gui").taskbar);
	require('atomos-framework');
	setInterval(reset, 1);
	ipcRenderer.on('new-notification', function (e, options) {
		if (!options.title) options.title = "";
		$("#notifications").append(`
<div class="media border border-bottom-0 border-left-0 border-right-0 py-2">
  <img class="mr-3" src="${options.icon}" style="max-width:48px">
  <div class="media-body">
    <h6 class="mt-0 mb-1">${ options.title } <button class="btn btn-sm btn-info material-icons p-0 m-0" onclick="$(this).parents('.media').remove()">done</button></h6>
    <small>${options.body}</small>
  </div>
</div>`);
		$("p.lead").hide();
		$("#notifications")[0].id = "notificationsOpened";
		setTimeout(function () {
			$("p.lead").show();
			$("#notificationsOpened")[0].id = "notifications";
			win.hide();
		}, 5000);
		win.showInactive();
	});

	function reset() {
		let alertHeight = $("main").outerHeight();
		let bounds = taskbar.getBounds();
		win.setPosition(bounds.x + bounds.width - win.getContentSize()[0], bounds.y - Math.ceil(alertHeight));
		win.setSize(win.getContentSize()[0], Math.ceil(alertHeight));
	}
</script>
