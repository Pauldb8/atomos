<body>
<script>
	const {
		app,
		Notification,
		Menu,
		registry
	} = require('atomos-framework');
	const args = app.arguments;
	const fs = require('fs-extra');
	const {
		ipcRenderer,
		remote
	} = require('electron');
	const {
		BrowserWindow
	} = remote;
	window.$ = window.jQuery = require("jquery");
	$.getScript(osRoot + "/node_modules/jquery-ui-npm/jquery-ui.min.js");
	window.Popper = require("popper.js");
	require("bootstrap");
	const win = app.window;
	const path = require("path");
	const URL = require("url").URL;
	let regs;
	registry.get(true).then(function (reg) {
		regs = reg;
	})
	app.window.on('blur', function () {
		$("#winBtns .btn-danger").removeClass("btn-danger").addClass("btn-outline-danger");
		$("main").css("boxShadow", "0px 0px 0.5rem 0 rgba(0,0,0,0.5)");
	});
	app.window.on('focus', function () {
		$("#winBtns .btn-outline-danger").removeClass("btn-outline-danger").addClass("btn-danger");
		$("main").css("boxShadow", "0px 0px 0.5rem 0 black");
	});
</script>
<main>
	<nav class="btn-toolbar d-flex">
		<button action="up" class="btn btn-outline-primary material-icons mr-1" style="display: none">keyboard_arrow_left
		</button>
		<div class="dropdown-menu" aria-labelledby="menu">
			<button class="dropdown-item" onclick="app.launch('aos-about')">About PC</button>
			<button class="dropdown-item" onclick="window.close()">Exit</button>
		</div>
		<button action="menu" class="btn btn-outline-primary material-icons" type="button"
		        id="menu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">reorder
		</button>
		<header class="d-flex align-items-center justify-content-center" action="path"
		        style="-webkit-app-region: drag; flex-grow:2">Control Center
		</header>
		<div id="winBtns" style="margin-left: auto;display:flex;align-items: center; margin-right:0.25rem;">
			<button class="btn btn-sm btn-outline-success material-icons p-2"
			        onclick="if(app.window.isMaximized()) app.window.restore(); else app.window.maximize();"></button>
			<button class="btn btn-sm btn-outline-warning material-icons p-2 mx-2" onclick="app.window.minimize();"></button>
			<button class="btn btn-sm btn-danger material-icons p-2" onclick="app.window.close();"></button>
		</div>
	</nav>
<section active data-location="Control Center" class="col-lg-3 p-lg-0 p-2"></section>
</main>
<script>
	window.onload = function () {
		$("[action=up]").click(function () {
			let dest = $("[action=path]").text();
			if (!dest.includes("/")) return;
			$("section").removeAttr("active");
			$('[data-location="Control Center"] .btn').removeClass("active");
			$("[data-location='" + path.dirname(dest).trim() + "']").attr("active", "active");
			$("[action=path]").text(path.dirname(dest).trim());
			if (!path.dirname(dest).trim().includes("/")) $(this).fadeOut(200);
			document.title = path.dirname(dest).trim();
		});
		$("body").on("click", '[data-location="Control Center"] .btn', function (e) {
			e.preventDefault();
			$('[data-location="Control Center"] .btn').removeClass("active");
			$(this).addClass("active");
			$("section").removeAttr("active");
			$("[data-location='" + $(this).attr("data-to") + "']").attr("active",
				"active");
			$("[action=path]").text($(this).attr("data-to"));
			$("[action=up]").fadeIn(200);
			document.title = $(this).attr("data-to").substring($(this).attr("data-to").lastIndexOf(
				"/") + 1).trim();
		});
		if (args.section) $('[data-location="Control Center"] .btn:contains("' + args.section + '")').first().click();
		fs.readdir(path.join(__dirname, "modules")).then(function(items) {
			items.forEach(function(item) {
				if(!item.endsWith(".html")) return;
				fs.readFile(path.join(__dirname, "modules", item), "utf-8").then(function (content) {
					$("main").append(content)
				}, console.error);
			})
		})
	};

	function AddSection(opts) {
		$('[data-location="Control Center"]').append(`<a href=# data-to="${opts.title}" class="btn btn-outline-primary border-0"><img src="${opts.icon}" class="mb-2"><div>${path.basename(opts.title)}</div></a>`);
	}
</script>
<style>
	p {
		margin: 0;
	}

	body {
		background: none !important;
		padding: 0.5rem;
	}

	section {
		display: none !important;
		flex-grow: 2;
		overflow: auto;
		height: 100%;
		position: relative;
	}

	.btn-link img {
		max-width: 48px
	}

	section[active] {
		display: flex !important;
		background: white;
	}

	section .btn-outline-primary {
		color: black
	}

	.modal-backdrop {

		margin: 0.5rem;
		border-radius: 0.25rem;

	}

	@media (max-width: 990px) {
		section[data-location="Control Center"] {
			padding: 0 0.5rem;
			align-items: flex-start;
		}

		section[data-location="Control Center"] .btn {
			text-align: center;
			padding: 0.25rem 0.5rem;
			font-size: 1em;
			max-width: 100px;
			white-space: pre-wrap;
			word-wrap: break-word;
			display: inline-flex;
			flex-direction: column;
			align-items: center;
			vertical-align: top;
		}

		section[data-location="Control Center"] img {
			width: 48px;
		}
	}

	@media (min-width: 991px) {
		section[data-location="Control Center"] {
			display: flex !important;
			position: absolute;
			left: 0;
			background: white;
			padding: 0.5rem 0;
			border-right: 1px solid #DDD;
			top: 38px;
			flex-direction: column;
			background: none !important;
		}

		section[data-location="Control Center"] .btn {
			text-align: left !important;
			width: 100%;
			border-radius: 0;
			padding: 0.5rem 1rem;
			display: inline-block;
		}

		section[data-location="Control Center"] b {
			padding: 0.5rem 1rem;
			line-height: 0;
			display: inline-block;
		}

		section[data-location="Control Center"] img {
			display: none;
		}

		section:not([data-location="Control Center"]) {
			width: 75%;
			margin-left: auto;
		}
	}

	.dropdown-menu:not([aria-labelledby="menu"]) {
		z-index: 0 !important
	}

	section[data-location="Control Center"] .btn-link .text-center {
		width: 100%;
		white-space: normal;
	}

	b {
		font-variant: small-caps;
		text-transform: lowercase;
		color: #333;
		font-size: 1em;
	}

	body {
		display: flex;
		flex-direction: column;
		overflow: hidden;
		height: 100vh;
	}

	.btn-menu b {
		flex-grow: 2;
		line-height: 28px;
	}

	* {
		font-size: 1em
	}

	.btn-menu .material-icons {
		font-size: 24px;
		width: 30px;
		height: 30px;
		padding: 0 !important
	}

	#winBtns .btn-danger:hover::after,
	#winBtns .btn-danger:focus::after,
	#winBtns .btn-outline-danger:hover::after,
	#winBtns .btn-outline-danger:focus::after {
		content: "close";
		font-family: "Material Icons";
		position: absolute;
		top: 0;
		left: 0;
		margin-top: 0.5rem;
		line-height: 0;
		font-size: 1rem;
	}

	#winBtns .btn-outline-warning:hover::after,
	#winBtns .btn-outline-warning:focus::after {
		content: "expand_more";
		font-family: "Material Icons";
		position: absolute;
		top: 0;
		left: 0;
		margin-top: 0.5rem;
		line-height: 0;
		font-size: 1rem;
	}

	#winBtns .btn-outline-success:hover::after,
	#winBtns .btn-outline-success:focus::after {
		content: "expand_less";
		font-family: "Material Icons";
		position: absolute;
		top: 0;
		left: 0;
		margin-top: 0.5rem;
		line-height: 0;
		font-size: 1rem;
	}

	main {
		display: flex;
		flex-direction: column;
		flex-grow: 2;
		background: var(--transparent-white);
		border-radius: 0.25rem;
		box-shadow: 0 0 0.5rem black;
		overflow: hidden;
		position: relative;
	}

	nav {
		-webkit-app-region: drag;
		height: 38px;
	}

	nav button {
		-webkit-app-region: no-drag;
	}
</style>