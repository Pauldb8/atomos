<center class="btn-menu bg-light">
  <button action="up" class="btn btn-outline-primary btn-sm material-icons">keyboard_arrow_left</button>
  <b action="path">Control Center / Desktop Preferences</b>
  <button action="menu" class="btn btn-outline-primary btn-sm material-icons">reorder</button>
</center>
<section data-location="Control Center" class="p-2 flex-column">
  <group>
    <p><b>Appearance</b></p>
    <a class="btn btn-link text-center" href="#" data-to="Control Center / Desktop Preferences">
      <img src="/atomos/icons/Desktop.png" class="mb-2">
      <div class="text-center text-dark" style="width: 100%;white-space: normal;">Desktop Preferences</div>
    </a>
  </group>
</section>

<section active data-location="Control Center / Desktop Preferences" class="p-2 flex-column">
  <div id="image"></div>
  <button class="btn btn-secondary btn-sm btn-block my-2">Choose another...</button>
  <div class="text-right"><button class="btn btn-primary btn-sm">Apply</button>
</section>

<section data-location="Control Center / Manage Apps">

</section>
<style>
  p {
    margin: 0;
  }

  section {
    display: none !important;
    flex-grow: 2;
    overflow: auto;
  }
  .btn-link img {max-width:48px}

  section[active] {
    display: flex !important;
  }

  b {
    font-variant: small-caps;
    text-transform: lowercase;
    color: #333;
    font-size: 1em;
  }

  body {
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  #image {
    background-image: url(/atomos/resources/wallpaper.jpg);
    flex-grow: 2;
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center center;
    border: 1px solid dimgray;
  }

  .btn-menu b {
    flex-grow: 2;
    line-height: 28px;
  }

  .btn-link {
    width: 100px;
    font-size: 1em;
  }

  * {
    font-size: 1em
  }

  .btn-menu .material-icons {
    font-size: 24px;
    width: 30px;
    height: 30px;
    padding: 0 !important
  }
</style>
<script>
  require('atomos-framework');
  const fs = require('fs');
  const {
    ipcRenderer,
    remote
  } = require('electron');
  const {
    Menu
  } = remote;
  const app = remote.getCurrentWindow();
  window.$ = require("jquery");
  ipcRenderer.on("return-file", function(event, path) {
    $("#image").css("background-image", "url(" + path + ")");
  })
  window.onload = function() {
    $("[data-location='Control Center / Desktop Preferences'] .btn-primary").click(function() {
      fs.writeFileSync("/atomos/resources/wallpaper.jpg",
        fs.readFileSync($("[data-location='Control Center / Desktop Preferences'] #image").css("background-image")
          .substring(12, $("#image").css("background-image").length - 2))
      );
    })
    $("[data-location='Control Center / Desktop Preferences'] .btn-secondary").click(function() {
      window.new("aos-cabinet", {
        path: "/atomos/home/Pictures/",
        action: "ofd",
        okText: "Select",
        cancelText: "Cancel",
        title: "Choose a wallpaper..."
      }, {
        modal: true,
        parent: app
      })
    })
    $("[action=up]").click(function() {
      var path = $("b[action=path]").text();
      if(!path.includes("/")) return;
      $("section").removeAttr("active");
      $("[data-location='" + path.substring(0, path.lastIndexOf("/")).trim() + "']").attr("active", "active");
      $("b[action=path]").text(path.substring(0, path.lastIndexOf("/")).trim())
      app.setTitle(path.substring(0, path.lastIndexOf("/") - 1).trim())
    })
    $("[action=menu]").click(function() {
      const cm = [{
        label: "About PC",
        click() {window.new("aos-about")}
      }, {type: 'separator'}, {
        label: "Exit",
        click() {app.close()}
      }]
      Menu.buildFromTemplate(cm).popup(app, {async: true})
    })
    $('[data-location="Control Center"] .btn-link').click(function(e) {
        e.preventDefault();
      $("section").removeAttr("active");
      $("[data-location='" + $(this).attr("data-to") + "']").attr("active", "active");
      $("b[action=path]").text($(this).attr("data-to"))
      app.setTitle($(this).attr("data-to").substring($(this).attr("data-to").lastIndexOf("/") + 1).trim())
    })
  };
</script>
