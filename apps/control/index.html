<script>
	const args = require('atomos-framework').arguments;
	const fs = require('fs-extra');
	const {
		ipcRenderer,
		remote
	} = require('electron');
	const {
		app,
		BrowserWindow
	} = remote;
	window.$ = window.jQuery = require("jquery");
	$.getScript(app.getAppPath() + "/node_modules/jquery-ui-npm/jquery-ui.min.js");
	window.Popper = require("popper.js");
	require("bootstrap");
	const win = remote.getCurrentWindow();
	const path = require("path");
	const URL = require("url").URL;
</script>
<center class="btn-menu bg-light">
	<button action="up" class="btn btn-outline-primary btn-sm material-icons">keyboard_arrow_left</button>
	<b action="path" style="-webkit-app-region: drag">Control Center</b>
	<div class="dropdown">
		<button action="menu" class="btn btn-outline-primary btn-sm material-icons dropdown-toggle" type="button"
						id="menu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">reorder
		</button>
		<div class="dropdown-menu dropdown-menu-right" aria-labelledby="menu">
			<button class="dropdown-item" onclick="window.new('aos-about')">About PC</button>
			<button class="dropdown-item" onclick="window.close()">Exit</button>
		</div>
	</div>
</center>
<section active data-location="Control Center" class="col-lg-3 p-lg-0 p-2"></section>

<script>
	window.onload = function () {
		$("[action=up]").click(function () {
			let dest = $("b[action=path]").text();
			if (!dest.includes("/")) return;
			$("section").removeAttr("active");
			$('[data-location="Control Center"] .btn').removeClass("active");
			$("[data-location='" + path.dirname(dest).trim() + "']").attr("active", "active");
			$("b[action=path]").text(path.dirname(dest).trim());
			document.title = path.dirname(dest).trim();
		});
		$("body").on("click", '[data-location="Control Center"] .btn', function (e) {
			e.preventDefault();
			$('[data-location="Control Center"] .btn').removeClass("active");
			$(this).addClass("active");
			$("section").removeAttr("active");
			$("[data-location='" + $(this).attr("data-to") + "']").attr("active",
					"active");
			$("b[action=path]").text($(this).attr("data-to"));
			document.title = $(this).attr("data-to").substring($(this).attr("data-to").lastIndexOf(
					"/") + 1).trim();
		});
		if (args.section) $('[data-location="Control Center"] .btn:contains("' + args.section + '")').first().click();
		fs.readdir(path.join(__dirname, "modules")).then(function(items) {
			items.forEach(function(item) {
				fs.readFile(path.join(__dirname, "modules", item), "utf-8").then(function(content) {$("body").append(content)},console.error);
			})
		})
	};

	function AddSection(opts) {
		$('[data-location="Control Center"]').append(`<a href=# data-to="${opts.title}" class="btn btn-outline-primary border-0"><img src="${opts.icon}" class="mb-2"><div>${path.basename(opts.title)}</div></a>`);
	}
</script>
<style>
	p {
		margin: 0;
	}

	section {
		display: none !important;
		flex-grow: 2;
		overflow: auto;
		height: 100%;
	}

	.btn-link img {
		max-width: 48px
	}

	section[active] {
		display: flex !important;
	}

	.btn-outline-primary {
		color: black
	}

	@media (max-width: 990px) {
		section[data-location="Control Center"] {
			padding: 0 0.5rem;
			align-items: flex-start
		}

		section[data-location="Control Center"] .btn {
			text-align: center;
			padding: 0.25rem 0.5rem;
			font-size: 1em;
			max-width: 100px;
			white-space: pre-wrap;
			word-wrap: break-word;
			display: inline-flex;
			flex-direction: column;
			align-items: center;
			vertical-align: top;
		}

		section[data-location="Control Center"] img {
			width: 48px;
		}
	}

	@media (min-width: 991px) {
		section[data-location="Control Center"] {
			display: flex !important;
			position: fixed;
			left: 0;
			background: white;
			padding: 0.5rem 0;
			border-right: 1px solid darkgray;
			top: 31px;
			flex-direction: column;
		}

		section[data-location="Control Center"] .btn {
			text-align: left !important;
			width: 100%;
			border-radius: 0;
			padding: 0.5rem 1rem;
			display: inline-block;
		}

		section[data-location="Control Center"] b {
			padding: 0.5rem 1rem;
			line-height: 0;
			display: inline-block;
		}

		section[data-location="Control Center"] img {
			display: none;
		}

		section:not([data-location="Control Center"]) {
			width: 75%;
			margin-left: auto;
		}
	}

	.dropdown-menu:not([aria-labelledby="menu"]) {
		z-index: 0 !important
	}

	section[data-location="Control Center"] .btn-link .text-center {
		width: 100%;
		white-space: normal;
	}

	b {
		font-variant: small-caps;
		text-transform: lowercase;
		color: #333;
		font-size: 1em;
	}

	body {
		display: flex;
		flex-direction: column;
		overflow: hidden;
		height: 100vh;
	}


	.btn-menu b {
		flex-grow: 2;
		line-height: 28px;
	}

	* {
		font-size: 1em
	}

	.btn-menu .material-icons {
		font-size: 24px;
		width: 30px;
		height: 30px;
		padding: 0 !important
	}
</style>