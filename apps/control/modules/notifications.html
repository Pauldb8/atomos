<section data-location="Control Center / Notifications" class=" flex-column">
	<div class="container flex-column d-flex p-2" style="flex-grow:2">
		<p class="lead mb-2">Notification Settings</p>
		<p id="isMuted"></p>
		<div class="input-group mb-3">
			<select type="text" class="form-control custom-select">
				<option value="30">30 minutes</option>
				<option value="60">1 hour</option>
				<option value="360">6 hours</option>
				<option value="-1">For ever</option>
			</select>
			<div class="input-group-append">
				<button class="btn btn-outline-secondary" type="button">Mute notifications</button>
			</div>
		</div>
		<div class="card">
			<table class="table table-sm m-0">
				<thead>
				<tr>
					<th class="border-top-0"></th>
					<th class="border-top-0">Application</th>
					<th class="border-top-0"><i class="material-icons">message</i></th>
					<th class="border-top-0"><i class="material-icons">vibration</i></th>
				</tr>
				</thead>
				<tbody id="apps"></tbody>
			</table>
		</div>
	</div>
	<footer class="bg-light border border-left-0 border-right-0 border-bottom-0">
		<div class="container text-right p-2">
			<button class="btn btn-primary btn-sm">Apply changes</button>
		</div>
	</footer>
</section>
<script>
	AddSection({
		title: "Control Center / Notifications",
		icon: osRoot + "/icons/Notification.png"
	});
	Object.keys(regs.notificationPrefs).forEach(function (ap) {
				if (!fs.existsSync(path.join(osRoot, "apps", ap, "app.json"))) return;
				let appInfo = fs.readJsonSync(path.join(osRoot, "apps", ap, "app.json"));
				appInfo.icon = appInfo.icon.replace("$SYSTEM_ROOT", osRoot).replace("$APP_ROOT", path.join(osRoot, "apps", ap));
				$("#apps").append(`
<tr data-app="${ap}">
<th><img src="${appInfo.icon}" /></th>
<td>${appInfo.name}</td>
<td>
	<div class="custom-control custom-checkbox p-1">
		<input type="checkbox" class="custom-control-input" ${(regs.notificationPrefs[ap][0] ? "checked" : "")} id="${ap}message">
		<label class="custom-control-label" for="${ap}message"></label>
	</div>
</td>
<td>
	<div class="custom-control custom-checkbox p-1">
		<input type="checkbox" class="custom-control-input" ${(regs.notificationPrefs[ap][1] ? "checked" : "")} id="${ap}sound">
		<label class="custom-control-label" for="${ap}sound"></label>
	</div>
</td></tr>`);
			})

	$("#apps").append(`
<tr data-app="other">
<th><img src="${osRoot}/icons/Application.png" /></th>
<td>Other Applications</td>
<td>
	<div class="custom-control custom-checkbox p-1">
		<input type="checkbox" class="custom-control-input" checked disabled id="othermessage">
		<label class="custom-control-label" for="othermessage"></label>
	</div>
</td>
<td>
	<div class="custom-control custom-checkbox p-1">
		<input type="checkbox" class="custom-control-input" checked disabled id="othersound">
		<label class="custom-control-label" for="othersound"></label>
	</div>
</td></tr>`);
	$('[data-location="Control Center / Notifications"] .btn-primary').click(function () {
		let apps = {};
		$("#apps tr").each(function () {
			let app = $(this).attr("data-app");
			if (app === "other") return;
			apps[app] = [
				$(this).find(`#${app}message`)[0].checked,
				$(this).find(`#${app}sound`)[0].checked
			];
		});
		registry.set({notificationPrefs: apps}, true);
	});
	$('[data-location="Control Center / Notifications"] .btn-outline-secondary').click(function () {
		remote.BrowserWindow.getAllWindows().forEach(function (wind) {
			console.log(wind.getURL().includes("notification"), parseInt($('[data-location="Control Center / Notifications"] select').val()));
			if (wind.getURL().includes("notification/index.html"))
				wind.webContents.send("mute", parseInt($('[data-location="Control Center / Notifications"] select').val()))

		})
	})
</script>
<style>
	section[data-location="Control Center / Notifications"] th:not(:nth-child(2)),
	section[data-location="Control Center / Notifications"] td:not(:first-child) {
		width: 24px;
		line-height: 23px;
		max-width: calc(24px + 0.5rem)
	}

	section[data-location="Control Center / Notifications"] th img {
		width: 24px;
	}

	section[data-location="Control Center / Notifications"] th .material-icons {
		font-size: 18px;
	}

	section[data-location="Control Center / Notifications"] .card {
		height: 0;
		flex-grow: 2;
		overflow-y: auto;
		overflow-x: hidden;
	}

	section[data-location="Control Center / Notifications"] * {
		flex-shrink: 0;
	}


</style>