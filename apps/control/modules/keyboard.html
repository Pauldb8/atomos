<section data-location="Control Center / Keyboard" class="p-2">
	<div class="container flex-column d-flex">
		<p class="lead mb-2">Keyboard Layouts</p>
		<p>To switch to another keyboard layout, press <kbd><kbd>Alt</kbd>+<kbd>Shift</kbd></kbd>.</p>
		<div class="row mt-2 mx-0">
			<div class="dropdown-menu col" id="lkbLayouts"></div>
			<div class="mx-2 d-flex flex-column justify-content-center py-2">
				<button class="btn btn-primary btn-sm material-icons p-1 mb-1">arrow_back</button>
				<button class="btn btn-outline-primary btn-sm material-icons p-1 mt-1">arrow_forward</button>
			</div>
			<div class="dropdown-menu col" id="kbLayouts"></div>

		</div>
	</div>
</section>
<script>
	AddSection({
		title: "Control Center / Keyboard",
		icon: osRoot + "/icons/Keyboard.png"
	});
	let kbVars = {};
	kbVars.proc = require("child_process").spawn("localectl", ["list-x11-keymap-layouts"]);
	kbVars.layouts = "";
	kbVars.proc.stdout.on('data', function (chunk) {
		kbVars.layouts += chunk.toString();
	});
	kbVars.proc.stdout.on('end', function () {
		kbVars.layouts = kbVars.layouts.split("\n");
		kbVars.layouts.forEach((item) => $("#kbLayouts").append(`<div class='dropdown-item'>${item}</div>`));
		regs.keyboardLayouts.forEach((item) => $("#lkbLayouts").append(`<div class='dropdown-item'>${item}</div>`));
	});
	$(function () {

		function updateLayouts() {
			let layouts = [];
			$("#lkbLayouts *").each(function () {
				layouts.push(this.innerText.trim());
			});
			registry.set({keyboardLayouts: layouts}, true).then($.noop)
		}

		$("#kbLayouts").selectable({
			classes: {
				"ui-selected": "active",
				"ui-selecting": "active",
				"ui-unselecting": "active",
			}
		});
		$("#lkbLayouts").selectable({
			classes: {
				"ui-selected": "active",
				"ui-selecting": "active",
				"ui-unselecting": "active",
			}
		});
		$('[data-location="Control Center / Keyboard"] .btn-primary').click(function () {
			$("#kbLayouts .ui-selected").each(function () {
				$("#lkbLayouts").append(`<div class='dropdown-item'>${this.innerText.trim()}</div>`)
			});
			updateLayouts();
		});
		$('[data-location="Control Center / Keyboard"] .btn-outline-primary').click(function () {
			$("#lkbLayouts .ui-selected").each(function () {
				$(this).remove();
			});
			updateLayouts();
		})
	})
</script>
<style>
	section[data-location="Control Center / Keyboard"] .dropdown-menu {
		position: static;
		display: inline-block;
		z-index: 0;
		flex-grow: 2;
		overflow: auto;
	}
</style>