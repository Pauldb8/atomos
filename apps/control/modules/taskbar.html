<section data-location="Control Center / Taskbar" class="flex-column p-2">
	<p class="lead mb-3 mt-1">Item Order</p>
	<div class="dropdown-menu mb-2"></div>
	<div class="d-flex" style="flex-shrink:0">
		<button class="btn btn-success btn-sm"><i class="material-icons">add</i> Add Widget</button>
		<div class="spacer" style="flex-grow:2"></div>
	</div>
	<div class="spacer" style="flex-grow:2"></div>
	<div class="d-flex mt-2" style="flex-shrink:0">
		<b class="text-danger" style="display:none;line-height: 30px;">Restart is required to apply changes</b>
		<div class="spacer" style="flex-grow:2"></div>
		<button class="btn btn-primary btn-sm">Apply and Restart</button>
	</div>
</section>
<style>
	section[data-location="Control Center / Taskbar"] .dropdown-menu {
		position: static;
		display: inline-block;
		z-index: 0;
	}
</style>
<script>
	AddSection({
		title: "Control Center / Taskbar",
		icon: osRoot + "/icons/Taskbar.png"
	});


	let taskbarData;
	fs.readJson(app.getPath("appData") + "/taskbar.json")
			.then(function (data) {
				taskbarData = data;
				data.order.forEach(function (element) {
					$('section[data-location="Control Center / Taskbar"] .dropdown-menu').append("<div class='dropdown-item' id='" + element + "'>" + element[0].toUpperCase() + element.substring(1).split(/(?=[A-Z])/).join(" ") + "</div>")
				});
				$('section[data-location="Control Center / Taskbar"] .dropdown-menu').sortable({
					items: ".dropdown-item"
				});
				$("section[data-location=\"Control Center / Taskbar\"] .dropdown-item").on("contextmenu", function (e) {
					e.preventDefault();
					let that = this;
					Menu.buildFromTemplate(win, [{
						label: "Remove",
						click() {
							$(that).remove();
						}
					}]).popup()
				});
				$('section[data-location="Control Center / Taskbar"] .btn-primary').click(function () {
					let arr = $("section[data-location=\"Control Center / Taskbar\"] .dropdown-item").toArray();
					arr.forEach(function (item, index) {
						arr[index] = item.innerText.substring(0, 1).toLowerCase() + item.innerText.substring(1).split(" ").join("");
					});
					fs.writeJson(app.getPath("appData") + "/taskbar.json", {order: arr})
							.then(function () {
								BrowserWindow.fromId(remote.getGlobal("gui").taskbar).reload();

							})
							.catch(console.error)
				});
			})
				$('section[data-location="Control Center / Taskbar"] .btn-success').click(function () {
					$("#WidgetModal").modal("show");
				});
	$("#WidgetModal .btn-primary").click(function addWidget() {
		$("section[data-location=\"Control Center / Taskbar\"] .dropdown-menu").append("<div class='dropdown-item'>" + $("#WidgetModal .dropdown-item.active").text().trim() + "</div>");
		$("#WidgetModal").modal("hide");
	});

	fs.readdir(osRoot + "/sys/taskbar/plugins")
		.then(function (elements) {
			elements.forEach(function (e) {
				$("#WidgetModal .dropdown-menu").append("<div class='dropdown-item'>" + path.basename(e, ".html") + "</div>");
				});
			$("#WidgetModal .dropdown-item").click(function () {
				$("#WidgetModal .dropdown-item").removeClass("active");
				$(this).addClass("active");
			})
		});

</script>

<div class="modal fade" id="WidgetModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">Add Widget from Library</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
					aria-hidden="true">&times;</span></button>
			</div>
			<div class="modal-body">
				<div class="dropdown-menu d-inline-block position-static m-0 w-100"></div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancel</button>
				<button type="button" class="btn btn-primary btn-sm"><i class="material-icons">add</i> Add Widget</button>
			</div>
		</div>
	</div>
</div>
