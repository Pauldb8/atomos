<section data-location="Control Center / Desktop" class="flex-column">
	<div class="container col" style="overflow: auto; height:0; max-width: 600px;">
		<p class="lead my-3">Manage your Desktop</p>
		<img src="transparent.png" id="image">
		<div class="row">
			<div class="col-sm-5">
				<button class="btn btn-secondary btn-block mt-2" id="ImageChoose">Choose Image...</button>
			</div>
			<div class="col-sm-5 ml-auto">
				<select class="custom-select form-control mt-2 w-100">
					<option selected>Fill</option>
					<option>Tiled</option>
					<option>Center</option>
					<option>Stretch</option>
				</select>
			</div>
		</div>
		<p class="lead my-3">Online imaging services</p>
		<div class="card" style="min-height:200px;">
			<form class="list-group list-group-flush">
				<div class="list-group-item custom-control custom-radio ">
					<input type="radio" id="customWPService0" checked name="customWPService" value="none"
					       class="custom-control-input">
					<label class="custom-control-label ml-3" for="customWPService0">none</label>
				</div>
				<div class="list-group-item custom-control custom-radio ">
					<input type="radio" id="customWPService1" name="customWPService" value="aclock" class="custom-control-input">
					<label class="custom-control-label ml-3" for="customWPService1">Sony "alpha" Clock</label>
				</div>
			</form>
		</div>
	</div>

	<div class="text-right bg-light p-2 w-100">
		<button class="btn btn-primary btn-sm">Apply</button>
	</div>
</section>
<script>
	AddSection({
		title: "Control Center / Desktop",
		icon: osRoot + "/icons/Desktop.png"
	});
	if (regs.autoStart.filter((o) => {
			return o.src === __dirname + "/modules/aclock.js";
		}).length) {
		$("[name=customWPService][value=aclock]")[0].checked = true;
	} else
		$("[name=customWPService][value=none]")[0].checked = true;
	$("#image").css("background-image", "url(file:///" + encodeURI(app.getPath(
		"appData")).replace(/%5C/g, "/") + "/wallpaper.jpg)");
	$("[data-location='Control Center / Desktop'] .btn-primary").click(function () {
		let bg = decodeURI($("[data-location='Control Center / Desktop'] #image").css(
			"background-image"));
		let url = new URL(bg.substring(5, bg.length - 2));
		fs.readFile(decodeURI(url.pathname)).then(function (bin) {
			fs.writeFile(app.getPath("appData") + "/wallpaper.jpg", bin).then(() => {
				if (!regs.wallpaper)
					regs.wallpaper = {
						fillMode: "fill"
					}
				regs.wallpaper.fillMode = $(
					"[data-location='Control Center / Desktop'] select").val().toLowerCase();
				registry.set(regs, true).then($.noop);
			})
		});
		regs.autoStart.forEach(function (item, i) {
			if (item.src.includes(__dirname + "/modules/"))
				regs.autoStart.splice(i, 1);
		});
		switch ($("[name=customWPService]:checked").val()) {
			case "none":
				break;
			default:
				regs.autoStart.push({
					name: $("[for=" + $("[name=customWPService]:checked").attr("id") + "]").text().trim(),
					src: __dirname + "/modules/" + $("[name=customWPService]:checked").val() + ".js"
				})
		}
		registry.set(regs, true).then(() => $("[action=up]").click());
	});
	$("[data-location='Control Center /  Desktop'] #ImageChoose").click(function () {
		app.launch("aos-files", {
			path: app.getPath("pictures"),
			action: "open",
			okText: "Select",
			cancelText: "Cancel",
			title: "Choose a wallpaper..."
		}, {
			modal: true,
			parent: win
		})
	});
	ipcRenderer.on("return-file", function (event, path) {
		$("#image").css("background-image", "url(file:///" + encodeURI(path).replace(
			/%5C/g, "/") + ")");
	});
</script>
<style>
	#image {
		flex-grow: 2;
		background-size: cover;
		background-repeat: no-repeat;
		background-position: center center;
		border: 3px solid black;
		width: 100%;
	}

	.list-group-item .custom-control-label::before,
	.list-group-item .custom-control-label::after {
		width: 1em;
		height: 1em;
		left: 0.75rem;
		top: 1em;
	}

	.list-group-item .custom-control-label {
		display: flex;
		align-items: center;
	}

	.list-group-item {
		align-items: center;
		display: flex;
	}
</style>