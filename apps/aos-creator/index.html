<!DOCTYPE html>
<html class="h-100">

<head>
	<meta charset="utf-8" />
	<title>Create new file</title>
</head>

<body class="p-2 d-flex h-100 bg-transparent">
	<script>
		const {
			app,
			Notififcation
		} = require("atomos-framework");
		const path = require("path");
		const fs = require("fs-extra");
		if (typeof app.arguments === "string") {
			app.arguments = {
				path: app.arguments
			};
		} else if (!app.arguments.path) {
			if (app.window.getParentWindow())
				app.window.getParentWindow().webContents.send("stdout",
					"Not enough arguments.")
			else new Notification({
				title: "Folder was not specified",
				body: "Ensure you use correct arguments for launching File Creator."
			});
			window.close();
		}
	</script>
	<global class="h-100 d-flex p-0 flex-column col rounded">
		<div class="btn-toolbar">
			<header class="p-1">Create new file</header>
			<div id="winBtns" style="margin-left: auto;display:flex;align-items: center; margin-right:0.25rem;">
				<button class="btn btn-sm btn-outline-warning material-icons p-2 mx-2" onclick="app.window.minimize();"></button>
				<button class="btn btn-sm btn-danger material-icons p-2" onclick="app.window.close();"></button>
			</div>
		</div>
		<main class="d-flex col h-0 px-0 bg-white rounded-bottom text-truncate">
			<form class="col d-flex py-3 flex-column" id="file">
				<div class="form-group">
					<label for="fileInput">File name: </label>
					<input class="form-control form-control-sm" id="fileInput" name="fileInput" autofocus>
				</div>
				<footer class="mt-auto text-right">
					<button class="btn btn-sm btn-secondary mr-2" type="button" onclick="window.close()">Cancel</button>
					<button class="btn btn-sm btn-primary" type="submit"><i class="material-icons">add</i> Create</button>
				</footer>
			</form>
			<form class="col d-flex py-3 flex-column" id="folder">
				<div class="form-group">
					<label for="folderInput">Folder name: </label>
					<input class="form-control form-control-sm" id="folderInput" name="folderInput" autofocus>
				</div>
				<footer class="mt-auto text-right">
					<button class="btn btn-sm btn-secondary mr-2" type="button" onclick="window.close()">Cancel</button>
					<button class="btn btn-sm btn-primary" type="submit"><i class="material-icons">add</i> Create</button>
				</footer>
			</form>
			<form class="col d-flex py-3 flex-column" id="link">
				<div class="form-group">
					<label for="linkInput">Link name: </label>
					<input class="form-control form-control-sm" id="linkInput" name="linkInput" autofocus>
				</div>
				<div class="form-group">
					<div class="custom-control custom-radio">
						<input type="radio" id="lT1" name="linkType" value="aos" checked class="custom-control-input">
						<label class="custom-control-label" for="lT1">AtomOS application</label>
					</div>
					<div class="custom-control custom-radio">
						<input type="radio" id="lT2" name="linkType" value="lcmd" class="custom-control-input">
						<label class="custom-control-label" for="lT2">Linux command</label>
					</div>
				</div>
				<section id="aos">
					<div class="form-group">
						<input class="form-control form-control-sm" name="linkID" placeholder="Application ID">
					</div>
					<div class="form-group">
						<input class="form-control form-control-sm" name="linkArgs" placeholder="JSON-styled args">
					</div>
				</section>
				<section id="lcmd" style="display: none">
					<div class="form-group">
						<textarea class="form-control form-control-sm" name="linkArgs" placeholder="Command"></textarea>
					</div>
				</section>
				<div class="form-group">
					<textarea class="form-control form-control-sm" name="linkTitle" placeholder="Description (optional)"></textarea>
				</div>
				<footer class="mt-auto text-right">
					<button class="btn btn-sm btn-secondary mr-2" type="button" onclick="window.close()">Cancel</button>
					<button class="btn btn-sm btn-primary" type="submit"><i class="material-icons">add</i> Create</button>
				</footer>
			</form>
			<aside class="dropdown-menu position-static m-0 border-left-0 border-top-0 border-bottom-0 rounded-0 d-flex flex-column" style="order:-1">
				<a href="#file" class="dropdown-item"><i class="material-icons mr-2">attachment</i> Plain File</a>
				<a href="#folder" class="dropdown-item"><i class="material-icons mr-2">folder_open</i> Folder</a>
				<a href="#link" class="dropdown-item"><i class="material-icons mr-2">link</i> Link</a>
			</aside>
		</main>
	</global>

	<script>
		window.$ = require("jquery");

		app.window.on('blur', function() {
			$("#winBtns .btn-danger").removeClass("btn-danger").addClass(
				"btn-outline-danger");
			$("global").css("boxShadow",
				"0px 0px 0.5rem 0 rgba(0,0,0,0.5)");
		});
		app.window.on('focus', function() {
			$("#winBtns .btn-outline-danger").removeClass(
				"btn-outline-danger").addClass("btn-danger");
			$("global").css("boxShadow", "0px 0px 0.5rem 0 black");
		});

		$(window).on('hashchange', () => {
			$("aside a").removeClass("active")
			$(`a[href='${location.hash}']`).addClass("active");
			switch (location.hash) {
				case "#file":
					$("header").text("Create new file");
					document.title = "Create new file";
					break;
				case "#folder":
					$("header").text("Create new folder");
					document.title = "Create new folder";
					break;
				case "#link":
					$("header").text("Create new link");
					document.title = "Create new link";
					break;
			}
		});
		$("[name=linkType]").change(function() {
			$("#link section").hide();
			$("#" + this.value).show();
		});
		
		$(function() {
			$(".dropdown-item").first().addClass("active").click();
		})

		$("form").submit(function(e) {
			console.log(this)
			e.preventDefault();
					switch (this.id) {
						case "file":
							fs.writeFile(path.join(app.arguments.path, document.forms.file.fileInput
									.value), "")
								.then(function() {
									app.log("0x0: File created successfully.");
									console.log(path.join(app.arguments.path, document.forms.file.fileInput
									.value));
									//window.close();
								})
								.catch((e) => {
									app.log("0x1: File was not created. " + e);
									$("#file").append(
										"<div class='text-danger'>We were unable to create the file.</div>"
									);
									console.error(e);
								});
							break;
						case "folder":
							fs.ensureDir(path.join(app.arguments.path, document.forms.folder.folderInput.value))
								.then(function() {
									app.log("0x0: Folder created successfully.");
									console.log(path.join(app.arguments.path, document.forms.folder.folderInput
									.value));
									//window.close();
								})
								.catch((e) => {
									app.log("0x1: Folder was not created. " + e);
									$("#file").append(
										"<div class='text-danger'>We were unable to create the folder.</div>"
									);
									console.error(e);
								});
							break;
						case "link":

					}
		})
	</script>

	<style>
		global {
			box-shadow: 0 0 0.5rem black;
			background: var(--transparent-white);
		}
		
		form {
			overflow:auto;
			height:100%;
			flex-grow:2;
		}

		form:not(:target) {
			display: none !important;
		}

		header {
			-webkit-app-region: drag;
		}

		aside .dropdown-item:target {
			background: var(--primary);
			color: white;
			outline: none;
		}

		header button {
			-webkit-app-region: no-drag;
		}

		#winBtns .btn-danger:hover::after,
		#winBtns .btn-danger:focus::after,
		#winBtns .btn-outline-danger:hover::after,
		#winBtns .btn-outline-danger:focus::after {
			content: "close";
			font-family: "Material Icons";
			position: absolute;
			top: 0;
			left: 0;
			margin-top: 0.5rem;
			line-height: 0;
			font-size: 1rem;
		}

		#winBtns .btn-outline-warning:hover::after,
		#winBtns .btn-outline-warning:focus::after {
			content: "expand_more";
			font-family: "Material Icons";
			position: absolute;
			top: 0;
			left: 0;
			margin-top: 0.5rem;
			line-height: 0;
			font-size: 1rem;
		}

		#winBtns .btn-outline-success:hover::after,
		#winBtns .btn-outline-success:focus::after {
			content: "expand_less";
			font-family: "Material Icons";
			position: absolute;
			top: 0;
			left: 0;
			margin-top: 0.5rem;
			line-height: 0;
			font-size: 1rem;
		}
	</style>
</body>

</html>