<form class="btn-toolbar" onsubmit="navigate(event)">
	<div class="btn-group mr-1 btn-group-sm" style="flex-shrink:0">
		<button class="btn btn-outline-primary material-icons" action="back">arrow_back</button>
		<button class="btn btn-outline-primary material-icons" action="forward">arrow_forward</button>
	</div>
	<div class="btn-group mr-1 btn-group-sm">
		<button class="btn btn-outline-primary material-icons" action="refresh">refresh</button>
	</div>
	<div class="input-group mr-1" style="
    flex-grow: 2;
"><input class="form-control form-control-sm" name="path" type="text" value="http://atomos.org.uk/home" id="path"></div>
	<div class="btn-group btn-group-sm">
		<button class="btn btn-primary material-icons" action="navigate" type="submit">arrow_forward</button>
	</div>
</form>
<div class="alert alert-warning fixed-bottom m-0 rounded-0" style="display:none" role="alert">
	<button type="button" class="close" data-dismiss="alert" onclick="$(this).parent().fadeOut(200)" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
	<b>Maybe, the page is not working</b>
	<div>Try to toggle JavaScript and reload the page</div>
</div>
<webview src="http://atomos.org.uk/home"></webview>

<script>
	var browser = document.querySelector('webview');
	var win = require('electron').remote.getCurrentWindow();
	window.addEventListener("load", function() {
		$("button").click(function(e) {
			e.preventDefault();
		})
		if (window.arguments["path"]) {
			$("#path").val(window.arguments["path"] || "http://atomos.org.uk/home");
			navigate();
		}
		init();
	});

	function init() {
		var oldTitle = "";
		$("[action=back]").mouseup(function() {
			browser.goBack()
		});
		$("[action=forward]").mouseup(function() {
			browser.goForward()
		});
		$("[action=refresh]").mouseup(reNavigate);
		$("[action=navigate]").mouseup(navigate);
		browser.addEventListener("page-title-updated", function(event) {
			win.setTitle(event.title + " - Proton Web Browser")
		});
		browser.addEventListener("did-navigate", function(event) {
			$("#path").val(event.url);
		});
		browser.addEventListener("new-window", function(event) {
			console.log(event);
			if ((event.disposition == "foreground-tab" || event.disposition == "background-tab") && event.frameName === "") {
				window.new("proton", {
					path: event.url
				})
			}
		})
	}

	function reNavigate() {
		browser.reload();
	}

	function navigate(e) {
		try {
			e.preventDefault();
		} catch (e) {}
		var link = $("#path").val();
		if (link.indexOf(".") === -1) {
			link = "http://google.com/search?q=" + link;
		} else if (link.startsWith("http:") || link.startsWith("ftp:") || link.startsWith("https:") || link.startsWith("//")) 1 + 1;
		else {
			link = "http://" + link;
		}
		browser.loadURL(link);
		$(".alert-warning").fadeOut(200);
	}

</script>
<style>
	body {
		display: flex;
		flex-direction: column;
		height: 100%;
	}

	webview {
		flex-grow: 2;
		width: 100%;
		border: 0
	}

</style>
