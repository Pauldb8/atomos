<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Settings</title>
</head>
<body>
<div class="container py-3 pb-5 bg-transparent">
	<p class="lead">Proton Settings <a href="#"
	                                   onclick="win.webContents.executeJavaScript('$(\'#path\').val(\'proton://version\'); navigate();')"
	                                   class="btn btn-info p-1 material-icons float-right">info_outline</a></p>
	<p>
	<div><b>General</b></div>
	Proton is<span id="defaultbrowser"></span> the default browser.
	<button class="btn btn-sm btn-primary ml-2"
	        onclick="app.setDefault('browser');">
		Set As Default
	</button>
	<div class="custom-control custom-checkbox mt-1">
		<input type="checkbox" class="custom-control-input" id="saveHistory">
		<label class="custom-control-label" for="saveHistory">Save browser history</label>
	</div>
	</p>
	<footer class="fixed-bottom text-right bg-light p-2">
		<button class="btn btn-sm btn-primary">Apply and restart</button>
	</footer>
</div>
<script>
	const {
		app,
		registry
	} = require("atomos-framework");
	const win = app.window;
	window.$ = require("jquery");
	let cfg;
	registry.get(true).then((dApps) => {
		if (dApps.browser) {
			if (dApps.browser.app !== "proton")
				$("#defaultbrowser").text(" not");
		}
	});
	registry.get("proton").then((cfg) => {
		$("footer .btn-primary").click(function() {
			cfg.saveHistory = $("#saveHistory")[0].checked;
			registry.set(cfg, "proton").then(window.close)
		})
			if(cfg.nightMode) {
				$("body").addClass("bg-dark text-white");
				$("footer").addClass("bg-secondary").removeClass("bg-light")
			}
			$("#saveHistory")[0].checked = cfg.saveHistory;
		});
</script>
</body>
</html>