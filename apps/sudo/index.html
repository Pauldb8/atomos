<body class="p-2 d-inline-flex flex-column w-100 text-truncate bg-transparent">
	<form onsubmit="return false;" class="position-relative m-0 rounded p-2" style="background: var(--transparent-white);box-shadow: 0 0 0.5rem black;">
		<header class="d-flex">
			<img src="logo.png" width=48 height=48 class="mr-2" />
			<section class="col">
				<h6>App wants to run command as an administrator</h6>
				<div>Type administrator password to proceed:</div>
				<input class="form-control form-control-sm my-2" autofocus type="password">
			</section>
		</header>
		<footer class="d-flex">
			<b class="text-danger" style="flex-grow:2; opacity:0">Password incorrect</b>
			<button class="btn btn-secondary btn-sm mx-2" type="button" onclick="window.close()">Cancel</button>
			<button class="btn btn-primary btn-sm px-3" type="submit" onclick="execute()">Run</button>
		</footer>
		<overlay class="d-flex align-items-center justify-content-center rounded m-2" style="background:rgba(0,0,0,0.3); position:fixed; top:0;left:0; display: none !important; z-index:10001;">
			<i class="material-icons align-middle">refresh</i><span class="align-middle ml-2"
			 style="line-height:18px;">Executing command...</span>
		</overlay>
	</form>
	<script>
		const {
			app,
			registry
		} = require("atomos-framework");
		const args = app.arguments;
		const proc = require("child_process");
		window.$ = require("jquery");
		if (args.command || typeof args === "string") {
			if (args.title)
				$("header h6").text(args.title);
			if (args.message)
				$("header section div").text(args.message);
			registry.get(true).then((r) => {
				window.scale = r.uiScaling;
				setTimeout(reset, 100);
			});
		}

		function execute() {
			$("overlay").fadeIn();
			proc.exec("echo '" + $("input").val() + "' | sudo -k -S -- sh -c '" + (
				typeof args === "string" ? args : args.command) + "'", {
				cwd: args.cwd || "/"
			}, function(error, stdout, stderr) {
				$("overlay").fadeOut();
				stderr = stderr.replace("[sudo] password for " + process.env.USER + ": ",
					"");
				if (stderr.trim().startsWith("sudo:")) stderr = "";
				if (stderr.includes("incorrect password"))
					$(".text-danger").css("opacity", 1);
				else {
					app.window.getParentWindow().webContents.send("return-sudo", {
						error: error,
						stdout: stdout,
						stderr: stderr
					});
					window.close();
				}
			})
		}

		function reset() {
			app.window.setContentSize(app.window.getContentSize()[0], Math.ceil(($(
				"body").height() + 16) * scale));
			app.window.center();
		}
	</script>
</body>